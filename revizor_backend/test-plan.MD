**Тест-стратегия**
==================

**1\. Цели тестирования:**

*   Проверить корректность бизнес-логики (создание, получение, обновление, удаление сущностей Audit, Department, Employee, Revizor).

*   Обеспечить надёжность REST API (контракты, валидация запросов, корректные коды ответов).

*   Проверить защиту приложения от некорректных запросов и потенциальных уязвимостей.

*   Обеспечить масштабируемость и поддерживаемость через автоматизированное тестирование.


**2\. Основные принципы:**

*   Покрытие всех REST-эндпоинтов юнит- и интеграционными тестами.

*   Минимизация регрессий путём добавления автотестов к каждому новому функционалу.

*   Выявление дефектов на как можно более ранних стадиях разработки.

*   Автоматизация тестов там, где это возможно.

*   Проведение ручного тестирования для проверки пользовательского опыта и нетипичных сценариев.


**3\. Уровни тестирования:**

*   Unit Testing (Юнит-тесты для сервисов и контроллеров)

*   Integration Testing (Интеграционные тесты для проверки совместной работы компонентов)

*   End-to-End Testing (E2E тестирование через реальные HTTP-запросы)

*   Security Testing (Тестирование безопасности API)

*   Performance Testing (Тестирование производительности на уровне API)


**Тест-план**
=============

### **1\. Юнит-тестирование (Unit Testing)**

**Что тестировать:**

*   Сервисы (AuditServiceImpl, DepartmentService, EmployeeService, RevizorService).

*   Валидацию DTO-объектов (проверка @Valid, BindingResult).

*   Отдельные бизнес-методы (например, логика фильтрации аудитов по ID).


**Инструменты:**

*   JUnit 5

*   Mockito (для мокирования зависимостей)

*   AssertJ или Hamcrest для удобных проверок


**Особенности:**

*   Моки вместо настоящих репозиториев и баз данных.

*   Изоляция тестируемого класса.


### **2\. Интеграционное тестирование (Integration Testing)**

**Что тестировать:**

*   Взаимодействие контроллеров и сервисов.

*   Реальная работа репозиториев (JPA).

*   Запись и чтение данных из тестовой базы данных.


**Инструменты:**

*   Spring Boot Test (@SpringBootTest)

*   Testcontainers (подъём временной базы данных, например, MySQL в контейнере)

*   H2 Database (легковесная база для тестов)


**Особенности:**

*   Ближе к реальной среде.

*   Проверка транзакций, корректности SQL-операций.


### **3\. Тестирование REST API (End-to-End / API Testing)**

**Что тестировать:**

*   Все эндпоинты /api/audits, /api/departments, /api/employees, /api/revizors.

*   HTTP-ответы (коды 200, 201, 400, 404, 204 и др.).

*   Валидацию запросов и ошибок.

*   Структуру JSON-ответов.


**Инструменты:**

*   MockMvc (@WebMvcTest) для юнит-тестов контроллеров.

*   Postman или REST-assured для интеграционных тестов.


**Особенности:**

*   Проверка контрактов API (формат запросов и ответов).

*   Проверка корректности валидационных ошибок.


### **4\. Тестирование безопасности (Security Testing)**

**Что тестировать:**

*   Защита от несанкционированного доступа (если появится аутентификация/авторизация).

*   Защита от SQL-инъекций, XSS (если обрабатываются пользовательские данные).

*   Проверка CORS-политики (@CrossOrigin(origins = "\*") на всех контроллерах).


**Инструменты:**

*   OWASP ZAP для сканирования уязвимостей.

*   Spring Security Test (если внедряется безопасность).


**Особенности:**

*   Сейчас в проекте нет явной безопасности, но планировать её тестирование нужно на будущее.


### **5\. Тестирование производительности (Performance Testing)**

**Что тестировать:**

*   Производительность API при высокой нагрузке.

*   Проверка скорости ответа при большом количестве аудитов, сотрудников и ревизоров.


**Инструменты:**

*   JMeter или Gatling для нагрузочного тестирования.


**Особенности:**

*   Имитация множества одновременных запросов.

*   Оценка времени отклика и устойчивости системы.


### **6\. Тестирование на отказоустойчивость (Fault Tolerance Testing)**

**Что тестировать:**

*   Поведение приложения при недоступности базы данных.

*   Корректную обработку внутренних ошибок.


**Инструменты:**

*   Инструментальные отключения базы данных (Testcontainers).

*   Искусственное внесение ошибок.


### **7\. Тестирование совместимости (Compatibility Testing)**

**Что тестировать:**

*   Совместимость API с различными клиентами (браузеры, мобильные приложения, API-клиенты).

*   Работа с разными версиями баз данных (MySQL, MariaDB).


### **8\. Регрессионное тестирование (Regression Testing)**

**Что тестировать:**

*   Проверка старого функционала после каждого изменения кода.


**Инструменты:**

*   Автоматизированные тесты в CI/CD (например, GitHub Actions, GitLab CI).


### **9\. Тестирование миграций базы данных (если появится)**

**Что тестировать:**

*   Правильность применения изменений в базе данных (hbm2ddl.auto=update пока работает, но на продакшене может потребоваться Liquibase/Flyway).


**Резюме**
==========

| Вид тестирования              | Инструменты                         | Статус в проекте | Требуется внедрение/планирование |
|-------------------------------|-------------------------------------|------------------|----------------------------------|
| Юнит-тесты                    | JUnit, Mockito                      | ❌ Нет           | ✅ Требуется                     |
| Интеграционные тесты          | Spring Boot Test, H2                | ❌ Нет           | ✅ Требуется                     |
| API-тесты (E2E)               | MockMvc, REST-assured               | ❌ Нет           | ✅ Требуется                     |
| Безопасность                  | OWASP ZAP, Spring Security Test     | ❌ Нет           | ✅ Требуется                     |
| Производительность            | JMeter, Gatling                     | ❌ Нет           | ✅ Требуется                     |
| Отказоустойчивость            | Testcontainers                      | ❌ Нет           | ✅ Требуется                     |
| Регрессионное тестирование    | CI/CD Pipelines                     | ❌ Нет           | ✅ Требуется                     |
| Совместимость                 | Ручное тестирование                 | ❌ Нет           | ✅ Требуется                     |
| Тестирование миграций БД      | Liquibase/Flyway                    | ❌ Нет           | ✅ Требуется                     |